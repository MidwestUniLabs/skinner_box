{% extends "base.html" %}

{% block head %}
    <title>Skinnerbox - I/O Testing</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
{% endblock %}

{% block content %}
    <div class="container" style="display: block; text-align: center;">
        <h2>I/O Testing</h2>

        <div class="mock-banner" id="mockBanner">
            <p>⚠️ WARNING: Running in **MOCK MODE** - No real GPIO changes will be made.</p>
            <button class="close-btn" onclick="document.getElementById('mockBanner').style.display='none'">X</button>
        </div>
        

        <div class="buttons">
            <button class="button" value="feeder">Feed</button>
            <button class="button" value="water">Water</button>
            <button class="button" value="buzzer">Sound Buzzer</button>
            <button class="button" value="light">Light Stimulus</button>
            <button class="button" value="lever">Lever Press</button>
            <button class="button" value="poke">Nose Poke</button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>
{% endblock %}

{% block scripts %}
<script>
    window.onload = function() {
        document.querySelectorAll('.button').forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault();
                const action = this.getAttribute('value');

                fetch('/test_io', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action })
                })
                .then(response => response.json())
                .then(data => {
                    showToast(`${action} executed successfully!`, true);
                    this.classList.add('active');
                    setTimeout(() => this.classList.remove('active'), 500);
                })
                .catch(error => {
                    console.error('Error executing I/O action:', error);
                    showToast(`Failed to execute ${action}.`, false);
                });
            });
        });
    };

    function showToast(message, success = true) {
        const toast = document.createElement('div');
        toast.className = `toast ${success ? 'toast-success' : 'toast-error'}`;
        toast.textContent = message;
        document.getElementById('toast-container').appendChild(toast);

        setTimeout(() => {
            toast.classList.add('fade-out');
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    }
</script>
{% endblock %}
